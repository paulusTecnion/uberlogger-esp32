<h1>Configuration</h1>
<form id="configuration">
  <div class="visible" id="loading">
    <p><i>Loading current configuration, please wait...</i></p>
  </div>

  <div class="invisible" id="config">
    <p>
      Updating the configuration requires clicking the "Save settings" button to
      save the configuration and activate it. Intermediate changes will not be
      saved.
    </p>

    <h2>Logging settings</h2>
    <div class="group" id="logging_configuration">
      <h3>System time</h3>

      <p>
        To ensure recordings are indicating the correct time, you can
        synchronize the real time clock with the local time.
      </p>
      <input
        id="btn_sync_time"
        class="button"
        type="button"
        name="btn_sync_time"
        value="Synchronize to local time"
        onclick="syncTime()"
      />
    </div>

    <h2>Channel configuration</h2>
    <div class="group" id="sampling_configuration">
      <h3>Sampling rate and resolution</h3>
      <p>
        Select the desired sample rate:
        <select
          name="LOG_SAMPLE_RATE"
          id="LOG_SAMPLE_RATE"
          class="json-as-number"
        >
          <!-- <option value="0">Once per minute</option>
          <option value="1">Once per 10 seconds</option> -->
          <option value="0">1 Sample/hour</option>
          <option value="1">1 Sample/10 minutes</option>
          <option value="2">1 Sample/5 minutes</option>
          <option value="3">1 Sample/minute</option>
          <option value="4">1 Sample/10 seconds</option>
          <option value="5">1 Sample/s</option>
          <option value="6">2 Samples/s</option>
          <option value="7">5 Samples/s</option>
          <option value="8">10 Samples/s</option>
          <option value="9">25 Samples/s</option>
          <option value="10">50 Samples/s</option>
          <option value="11">100 Samples/s</option>
          <option value="12">250 Samples/s</option>
        </select>

        <p>
          Select the desired analog resolution:
          <select
            name="ADC_RESOLUTION"
            id="ADC_RESOLUTION"
            class="json-as-number"
          >
            <option value="12">12 bits</option>
            <option value="16">16 bits</option>
          </select>
        </p>
        <p>
          <i
            ><b>Note:</b>16-bits will not improve resolution for temperature
            sensors, since these channels will be scaled down to 12-bits.</i
          >
        </p>

        <h4>Averaging</h4>
        <p>For the sample frequencies below 1 Hz, you can choose to average the samples over the desired sample frequency or only take one sample at the desired sample rate. For example, if you enable this option with a sample frequency of 1 Sample/minute, the average will be taken over 1 minute of samples using an IIR filter. After 1 minute, the average will be output to the file.</p>
        <p>
          <i><b>Note:</b>averaging is done by sampling at 25 Hz and using an IIR low pass filter with -3 dB cut-off frequencies at 1/(sample frequency).</i>
        </p>
        <select  name="AVERAGE_SAMPLES"
        id="AVERAGE_SAMPLES"
        class="json-as-number">
          <option value="0">Normal sampling (default)</option>
          <option value="1">Average samples over time</option>
        </select>
      </p>

      <div id="configuration_done">
        <input
          id="saveForm"
          class="button_text"
          type="button"
          onClick="setConfig()"
          value="Save sample settings"
        />
      </div>
    </div>

    <div class="group" id="channel_configuration">
      <h3>Analog & digital channels</h3>
      <p>Select the mode used for the analog channels.</p>
      <p>
        <i
          ><b>Important:</b> ensure the hardware configuration (DIP-switch
          setting) is equal to the settings below.</i
        >
      </p>

      <table class="compact-table" width="100%">
        <tr>
          <th>Enable</th>
          <th>Analog channel</th>
          <th>Mode</th>
          <th>Range</th>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN1_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 1</td>
          <td>
            <select
              name="NTC1"
              id="NTC1"
              class="json-as-bool"
              onchange="disableAIN('1')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN1_RANGE" id="AIN1_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN2_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 2</td>
          <td>
            <select
              name="NTC2"
              id="NTC2"
              class="json-as-bool"
              onchange="disableAIN('2')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN2_RANGE" id="AIN2_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN3_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 3</td>
          <td>
            <select
              name="NTC3"
              id="NTC3"
              class="json-as-bool"
              onchange="disableAIN('3')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN3_RANGE" id="AIN3_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN4_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 4</td>
          <td>
            <select
              name="NTC4"
              id="NTC4"
              class="json-as-bool"
              onchange="disableAIN('4')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN4_RANGE" id="AIN4_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN5_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 5</td>
          <td>
            <select
              name="NTC5"
              id="NTC5"
              class="json-as-bool"
              onchange="disableAIN('5')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN5_RANGE" id="AIN5_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN6_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 6</td>
          <td>
            <select
              name="NTC6"
              id="NTC6"
              class="json-as-bool"
              onchange="disableAIN('6')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN6_RANGE" id="AIN6_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN7_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 7</td>
          <td>
            <select
              name="NTC7"
              id="NTC7"
              class="json-as-bool"
              onchange="disableAIN('7')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN7_RANGE" id="AIN7_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="AIN8_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Analog Input 8</td>
          <td>
            <select
              name="NTC8"
              id="NTC8"
              class="json-as-bool"
              onchange="disableAIN('8')"
            >
              <option value="0">Analog in</option>
              <option value="1">NTC</option>
            </select>
          </td>
          <td>
            <select name="AIN8_RANGE" id="AIN8_RANGE" class="json-as-bool">
              <option value="0">+/-10 V</option>
              <option value="1">+/-60 V</option>
            </select>
          </td>
        </tr>

        <!-- Digital Inputs Rows -->
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN1_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 1</td>
          <td></td>
          <!-- Mode column left empty for digital inputs -->
          <td></td>
          <!-- Range column can be left empty or repurposed if needed -->
        </tr>
        <!-- Repeat for DI2 to DI6 with onchange added -->
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN2_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 2</td>
          <td></td>
          <td></td>
        </tr>
        <!-- Continue adding similar blocks for DI3 to DI6, changing the numbers accordingly -->
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN3_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 3</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN4_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 4</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN5_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 5</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <input
              type="checkbox"
              name="DIN6_ENABLE"
              value="1"
              class="json-as-bool"
            />
          </td>
          <td>Digital Input 6</td>
          <td></td>
          <td></td>
        </tr>
      </table>

      <div id="configuration_done">
        <input
          id="saveForm"
          class="button_text"
          type="button"
          onClick="setConfig()"
          value="Save channel settings"
        />
      </div>

      <h3>Analog Calibration</h3>
      <p>
        Hit the calibration button below to start zero calibration of the
        channels
      </p>
      <div id="calibration">
        <input
          id="calibrationStart"
          class="button_text"
          type="button"
          onClick="startCalibration()"
          value="Start calibration"
        />
        <p id="calibStatus"></p>
      </div>

      <span>
        <h2>File options</h2>

        <span>
          <h3>File format</h3>
          <input
            id="log_mode"
            name="LOG_MODE"
            class="element radio json-as-number"
            type="radio"
            value="1"
            checked="true"
          />
          <label class="choice" for="log_mode"
            >CSV<br />Write CSV files directly. Recommended for low sample rates
            or short measurements.</label
          >

          <input
            id="log_mode"
            name="LOG_MODE"
            class="element radio json-as-number"
            type="radio"
            value="0"
          />
          <label class="choice" for="log_mode"
            >Raw data<br />Write the raw data and convert the data to a CSV file
            afterwards. This option is recommended for long measurements. You
            can use the Python conversion script or Windows exe tool to convert
            the .dat files to .csv. Download the Python
            <a href="convert_raw.py">here</a> or check the Uberlogger website
            for the Windows tool in the download section.
          </label>
        </span>

        <span>
          <h3>File name mode</h3>
          <input
            id="file_name_mode"
            name="FILE_NAME_MODE"
            class="element radio json-as-number"
            type="radio"
            value="0"
            checked="true"
          />
          <label class="choice" for="file_name_mode"
            >Sequential<br />File names are written with prefix + sequence
            number. Example: log0, log1 etc. Existing files will be
            overwritten.</label
          >

          <input
            id="file_name_mode"
            name="FILE_NAME_MODE"
            class="element radio json-as-number"
            type="radio"
            value="1"
          />
          <label class="choice" for="file_name_mode"
            >Timestamp<br />File name will be like YYYYMMDD_Time_File Prefix.
            Example: 20240312_14-34-34_Logfile.csv. Each split part will have a
            new timestamp in UTC time.
          </label>
        </span>

        <span>
          <h3>CSV options</h3>
          <div>
            <label for="file_separator_char"
              >CSV separator character. Semicolon is recommended for
              Excel.</label
            >
            <select
              name="FILE_SEPARATOR_CHAR"
              id="file_separator_char"
              class="json-as-number"
            >
              <option value="0">Comma (,)</option>
              <option value="1">Semicolon (;)</option>
            </select>
            <label for="file_decimal_char"
              >Decimal notation character. Note: this option does not have
              effect when using RAW data file format. The conversion script will
              use the system's default decimal character.</label
            >
            <select
              name="FILE_DECIMAL_CHAR"
              id="file_decimal_char"
              class="json-as-number"
            >
              <option value="0">Dot (.)</option>
              <option value="1">Comma (,)</option>
            </select>
          </div>
        </span>

        <h3>File name and split size</h3>
        <label for="file_name_prefix">File name prefix</label>
        <input
          type="text"
          id="file_name_prefix"
          name="FILE_NAME_PREFIX"
          class="json-as-text"
          maxlength="70"
          class="element"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="none"
          value=""
        />

        <label for="file_split_size"
          >Max size of one log file (200 KB min and 2 GB max)</label
        >
        <div class="split-size-container">
          <input
            type="number"
            id="file_split_size"
            name="FILE_SPLIT_SIZE"
            class="json-as-number"
            max="4194304"
            step="1"
            oninput="validateIntegerInput(this)"
          />

          <select
            name="FILE_SPLIT_SIZE_UNIT"
            id="file_size_split_size_unit"
            class="json-as-number"
          >
            <option value="0">KB</option>
            <option value="1">MB</option>
            <option value="2">GB</option>
          </select>
        </div>

        <div id="configuration_done">
          <input
            id="saveForm"
            class="button_text"
            type="button"
            onClick="setConfig()"
            value="Save file options"
          />
        </div>
      </span>
    </div>

    <h2>Wi-Fi configuration</h2>
    <div class="group" id="wifi_configuration">
      <h3>Wi-Fi channel Hotspot</h3>
      <p>
        Select the Wi-Fi channel for the hotspot
        <select name="WIFI_CHANNEL" id="WIFI_CHANNEL" class="json-as-number">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
        </select>
      </p>
      <p>
        <i
          ><b>Note: </b>Please press the reset button manually after saving this
          setting</i
        >
      </p>
      <h3>Connection mode</h3>
      <span>
        <input
          id="wifi_mode_hotspot"
          name="WIFI_MODE"
          class="element radio json-as-number"
          type="radio"
          value="0"
          checked="true"
          onclick="wifiConfigVisibilityUpdate();"
        />
        <label class="choice" for="wifi_mode_hotspot"
          >Hotspot mode only<br />UberLogger acts as a Wi-Fi-hotspot where you
          can directly connect to.</label
        >

        <input
          id="wifi_mode_client"
          name="WIFI_MODE"
          class="element radio json-as-number"
          type="radio"
          value="1"
          onclick="wifiConfigVisibilityUpdate();"
        />
        <label class="choice" for="wifi_mode_client"
          >Hotspot + Client mode<br />Next to Wi-Fi hotspot, the UberLogger
          connects to your Wi-Fi-network as a client, and you can access the
          UberLogger through the IP-address that is assigned through your DHCP
          server.</label
        >
      </span>

      <div id="wifi_client_settings">
        <h3>Client details</h3>
        <p>
          Enter the details of your Wi-Fi-network below to allow the UberLogger
          to connect.
        </p>
        <p>
          <i
            ><b>Note:</b> in case connecting to Wi-Fi fails, press the MODE
            button for 5 seconds to enable the hotspot mode.</i
          >
        </p>
        <label for="WIFI_SSID">Network name (SSID)</label>
        <input
          id="WIFI_SSID"
          name="WIFI_SSID"
          class="element"
          type="text"
          maxlength="32"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="none"
          value=""
        />

        <label for="WIFI_PASSWORD">Password</label>
        <input
          id="WIFI_PASSWORD"
          name="WIFI_PASSWORD"
          class="element"
          type="text"
          maxlength="64"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="none"
          value=""
        />

        <p>
          After entering the connection details above, you can test the Wi-Fi
          connection by clicking on the button below.
        </p>
        <p>
          <i
            ><b>Tip:</b> after configuring, this page will be available via
            http://IPADDRESS (e.g. http://192.168.1.123).</i
          >
        </p>

        <p>
          Connection:
          <span id="WIFI_TEST_STATUS" name="WIFI_TEST_STATUS">...</span
          ><input
            type="checkbox"
            name="switch"
            id="wifi-state-checkbox"
            class="check"
            style="display: none"
          /><br />
          IP-address:
          <a
            href="http://"
            id="WIFI_TEST_IP"
            name="WIFI_TEST_IP"
            target="_blank"
            >0.0.0.0</a
          ><br />
          RSSI: <span id="WIFI_TEST_RSSI" name="WIFI_TEST_RSSI">-</span> dB
        </p>

        <p>
          <i
            ><b>Note:</b> the Wi-Fi-signal strength (RSSI) should be above -80
            dB for a stable connection (e.g. -75 dB is OK).</i
          >
        </p>
      </div>
      <div>
        <input
          id="btn_test_wifi_network"
          class="button_text"
          type="button"
          value="Save Wi-Fi settings"
          onclick="setConfig()"
        />
      </div>
    </div>

    <h2>Backup or restore configuration</h2>
    <div class="group" id="backuprestoreconfig">
      <h3 class="first">Restore defaults</h3>
      <label class="description" style="padding-bottom: 10px"
        >Restore the default settings by clicking the button below. They will be
        saved after clicking the save button at the bottom of this page.</label
      >
      <input
        id="btn_load_defaults"
        class="button"
        type="button"
        name="btn_load_defaults"
        value="Restore default settings"
        onclick="loadFormDefaults()"
      />

      <br />

      <h3>Import/export configuration</h3>
      <label class="description" style="padding-bottom: 10px"
        >You can download the current configuration and import it at a later
        time. When importing, the settings will be saved only after clicking the
        save button at the bottom of this page.</label
      >
      <input
        id="btn_import_config"
        name="btn_import_config"
        class="button"
        type="button"
        value="Import settings from file..."
        onclick="importConfigfile()"
      />
      <input
        id="file_import_config"
        name="file_import_config"
        class="button"
        type="file"
        onchange="importConfigFileSelected()"
        accept=".json"
        style="visibility: hidden; display: none"
      />
      <a href="/ajax/getConfig?download=true" target="_blank"
        ><button class="button" type="button">
          Download current settings
        </button></a
      >
      <h3 class="first">Save all settings</h3>
      <input
        id="btn_test_wifi_network"
        class="button_text"
        type="button"
        value="Save all settings"
        onclick="setConfig()"
      />
    </div>

    <h2 class="first">Firmware</h2>
    <p>
      Current firmware version: <span name="FW_VERSION">-</span><br />
      <a href="/fwupdate/">Update firmware</a>
    </p>
  </div>
</form>
